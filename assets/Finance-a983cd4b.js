import{_ as re,j as r,k as F,r as i,l as pe,o as x,c as D,a as d,b as t,w as a,n as me,p as z,u as B,e as c,F as q,q as E,t as y,s as A,v as j,E as ve,x as M,y as ce,z as fe,A as _e,B as ye}from"./index-ee6a3236.js";const ge={class:"finance"},be={class:"header"},Ve={class:"header-operations"},xe={class:"search-bar"},we={class:"card-amount income"},ke={class:"card-amount expense"},Ce={class:"card-amount warning"},he={class:"pagination"},Te={__name:"Finance",setup(Ue){const C=r(""),w=r([]),h=r(""),$=r(1),I=r(10),O=r(!1),g=r(!1),f=r("add"),S=r(null),o=r({name:"",room:"",type:"",amount:0,description:""}),Q={name:[{required:!0,message:"请输入姓名",trigger:"blur"}],room:[{required:!0,message:"请输入房间号",trigger:"blur"}],type:[{required:!0,message:"请选择账单类型",trigger:"change"}],amount:[{required:!0,message:"请输入金额",trigger:"blur"}]},L=["收入","支出"],G=[{label:"房费",value:"房费"},{label:"护理费",value:"护理费"},{label:"医疗费",value:"医疗费"},{label:"餐费",value:"餐费"},{label:"康复费",value:"康复费"},{label:"其他",value:"其他"}],H=[{text:"最近一周",value:()=>{const n=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*7),[e,n]}},{text:"最近一个月",value:()=>{const n=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*30),[e,n]}},{text:"最近三个月",value:()=>{const n=new Date,e=new Date;return e.setTime(e.getTime()-3600*1e3*24*90),[e,n]}}],p=r([{id:"1",date:"2025-02-20",name:"张建国",room:"301",type:"支出",amount:2e3,status:"已支付",description:"1月份房费"},{id:"2",date:"2025-02-21",name:"王淑芬",room:"302",type:"支出",amount:2500,status:"待支付",description:"1月份房费+护理费"},{id:"3",date:"2025-02-22",name:"李桂芝",room:"303",type:"支出",amount:3e3,status:"已支付",description:"1月份房费+特需护理费"},{id:"4",date:"2025-02-22",name:"赵明德",room:"305",type:"支出",amount:2800,status:"待支付",description:"1月份房费+医疗费"},{id:"5",date:"2025-02-23",name:"孙秀兰",room:"306",type:"收入",amount:1e4,status:"已支付",description:"预存3个月房费"},{id:"6",date:"2025-02-23",name:"王德福",room:"308",type:"支出",amount:2200,status:"已支付",description:"1月份房费+餐费"},{id:"7",date:"2025-02-24",name:"张玉珍",room:"310",type:"支出",amount:3500,status:"已支付",description:"1月份房费+康复理疗费"},{id:"8",date:"2025-02-24",name:"刘长海",room:"311",type:"支出",amount:4e3,status:"待支付",description:"1月份房费+特护费+医疗费"},{id:"9",date:"2025-02-25",name:"陈德华",room:"312",type:"收入",amount:8e3,status:"已支付",description:"预存2个月房费+护理费"},{id:"10",date:"2025-02-25",name:"刘淑英",room:"315",type:"支出",amount:2600,status:"已支付",description:"1月份房费+营养餐费"},{id:"11",date:"2025-02-26",name:"王金凤",room:"316",type:"支出",amount:3200,status:"待支付",description:"1月份房费+康复训练费"},{id:"12",date:"2025-02-26",name:"张宝华",room:"318",type:"收入",amount:12e3,status:"已支付",description:"预存半年房费"}]),N=F(()=>{let n=p.value;if(C.value){const e=C.value.toLowerCase();n=n.filter(s=>s.name.toLowerCase().includes(e)||s.room.toLowerCase().includes(e)||s.description.toLowerCase().includes(e))}return w.value&&w.value.length===2&&(n=n.filter(e=>{const s=new Date(e.date);return s>=w.value[0]&&s<=w.value[1]})),h.value&&(n=n.filter(e=>e.type===h.value)),n}),J=F(()=>N.value.length),K=n=>{switch(n){case"收入":return"success";case"支出":return"danger";default:return"info"}},W=n=>{switch(n){case"已支付":return"success";case"待支付":return"warning";case"已取消":return"info";default:return""}},X=()=>{f.value="add",o.value={name:"",room:"",type:"",amount:0,description:""},g.value=!0},Y=n=>{f.value="edit",o.value={...n},g.value=!0},Z=n=>{f.value="view",o.value={...n},g.value=!0},ee=n=>{ve.confirm(`确认支付 ${n.name} 的账单 ￥${n.amount}？`,"支付确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const e=p.value.findIndex(s=>s.id===n.id);e!==-1&&(p.value[e]={...n,status:"已支付"},M.success("支付成功"))})},te=async()=>{S.value&&await S.value.validate(n=>{if(n){if(f.value==="add"){const e=String(Math.max(...p.value.map(s=>Number(s.id)))+1);p.value.push({id:e,date:new Date().toISOString().split("T")[0],...o.value,status:"待支付"}),M.success("添加成功")}else if(f.value==="edit"){const e=p.value.findIndex(s=>s.id===o.value.id);e!==-1&&(p.value[e]={...o.value},M.success("修改成功"))}g.value=!1}})},b=F(()=>{const n=p.value.filter(u=>u.type==="收入").reduce((u,m)=>u+m.amount,0),e=p.value.filter(u=>u.type==="支出").reduce((u,m)=>u+m.amount,0),s=p.value.filter(u=>u.status==="待支付").reduce((u,m)=>u+m.amount,0);return{income:n,expense:e,pending:s}});return(n,e)=>{const s=i("el-icon"),u=i("el-button"),m=i("el-input"),le=i("el-date-picker"),v=i("el-option"),k=i("el-select"),T=i("el-card"),U=i("el-col"),ae=i("el-row"),_=i("el-table-column"),P=i("el-tag"),ne=i("el-table"),oe=i("el-pagination"),V=i("el-form-item"),ue=i("el-input-number"),se=i("el-form"),de=i("el-dialog"),ie=pe("loading");return x(),D("div",ge,[d("div",be,[e[18]||(e[18]=d("h2",null,"财务结算",-1)),d("div",Ve,[t(u,{type:"primary",onClick:X},{default:a(()=>[t(s,null,{default:a(()=>[t(B(ce))]),_:1}),e[15]||(e[15]=c("新增账单 "))]),_:1}),t(u,{onClick:n.handleExport},{default:a(()=>[t(s,null,{default:a(()=>[t(B(fe))]),_:1}),e[16]||(e[16]=c("导出账单 "))]),_:1},8,["onClick"]),t(u,{type:"success",onClick:n.handleBatchPay},{default:a(()=>[t(s,null,{default:a(()=>[t(B(_e))]),_:1}),e[17]||(e[17]=c("批量结算 "))]),_:1},8,["onClick"])])]),d("div",xe,[t(m,{modelValue:C.value,"onUpdate:modelValue":e[0]||(e[0]=l=>C.value=l),placeholder:"搜索账单...",style:{width:"200px"},clearable:""},{prefix:a(()=>[t(s,null,{default:a(()=>[t(B(ye))]),_:1})]),_:1},8,["modelValue"]),t(le,{modelValue:w.value,"onUpdate:modelValue":e[1]||(e[1]=l=>w.value=l),type:"daterange","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",shortcuts:H,style:{"margin-left":"10px"}},null,8,["modelValue"]),t(k,{modelValue:h.value,"onUpdate:modelValue":e[2]||(e[2]=l=>h.value=l),placeholder:"账单类型",clearable:"",style:{"margin-left":"10px",width:"120px"}},{default:a(()=>[(x(),D(q,null,E(L,l=>t(v,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),t(k,{modelValue:n.paymentStatus,"onUpdate:modelValue":e[3]||(e[3]=l=>n.paymentStatus=l),placeholder:"支付状态",clearable:"",style:{"margin-left":"10px",width:"120px"}},{default:a(()=>[t(v,{label:"已支付",value:"已支付"}),t(v,{label:"待支付",value:"待支付"}),t(v,{label:"已取消",value:"已取消"})]),_:1},8,["modelValue"])]),t(ae,{gutter:20,class:"statistics-cards"},{default:a(()=>[t(U,{span:6},{default:a(()=>[t(T,{shadow:"hover"},{header:a(()=>e[19]||(e[19]=[d("div",{class:"card-header"},[d("span",null,"总收入")],-1)])),default:a(()=>[d("div",we," ￥"+y(b.value.income.toFixed(2)),1)]),_:1})]),_:1}),t(U,{span:6},{default:a(()=>[t(T,{shadow:"hover"},{header:a(()=>e[20]||(e[20]=[d("div",{class:"card-header"},[d("span",null,"总支出")],-1)])),default:a(()=>[d("div",ke," ￥"+y(b.value.expense.toFixed(2)),1)]),_:1})]),_:1}),t(U,{span:6},{default:a(()=>[t(T,{shadow:"hover"},{header:a(()=>e[21]||(e[21]=[d("div",{class:"card-header"},[d("span",null,"待支付")],-1)])),default:a(()=>[d("div",Ce," ￥"+y(b.value.pending.toFixed(2)),1)]),_:1})]),_:1}),t(U,{span:6},{default:a(()=>[t(T,{shadow:"hover"},{header:a(()=>e[22]||(e[22]=[d("div",{class:"card-header"},[d("span",null,"结余")],-1)])),default:a(()=>[d("div",{class:A(["card-amount",b.value.income-b.value.expense>=0?"income":"expense"])}," ￥"+y((b.value.income-b.value.expense).toFixed(2)),3)]),_:1})]),_:1})]),_:1}),me((x(),z(ne,{data:N.value,style:{width:"100%","margin-top":"20px"}},{default:a(()=>[t(_,{prop:"date",label:"日期",width:"120"}),t(_,{prop:"name",label:"姓名",width:"120"}),t(_,{prop:"room",label:"房间号",width:"100"}),t(_,{prop:"type",label:"类型",width:"120"},{default:a(({row:l})=>[t(P,{type:K(l.type)},{default:a(()=>[c(y(l.type),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"amount",label:"金额",width:"120"},{default:a(({row:l})=>[d("span",{class:A({income:l.type==="收入",expense:l.type==="支出"})},y(l.type==="支出"?"-":"+")+"￥"+y(l.amount),3)]),_:1}),t(_,{prop:"status",label:"状态",width:"100"},{default:a(({row:l})=>[t(P,{type:W(l.status)},{default:a(()=>[c(y(l.status),1)]),_:2},1032,["type"])]),_:1}),t(_,{prop:"description",label:"备注"}),t(_,{label:"操作",width:"150",fixed:"right"},{default:a(({row:l})=>[t(u,{link:"",type:"primary",onClick:R=>Y(l)},{default:a(()=>e[23]||(e[23]=[c("编辑")])),_:2},1032,["onClick"]),t(u,{link:"",type:"primary",onClick:R=>Z(l)},{default:a(()=>e[24]||(e[24]=[c("查看")])),_:2},1032,["onClick"]),l.status==="待支付"?(x(),z(u,{key:0,link:"",type:"success",onClick:R=>ee(l)},{default:a(()=>e[25]||(e[25]=[c(" 支付 ")])),_:2},1032,["onClick"])):j("",!0)]),_:1})]),_:1},8,["data"])),[[ie,O.value]]),d("div",he,[t(oe,{"current-page":$.value,"onUpdate:currentPage":e[4]||(e[4]=l=>$.value=l),"page-size":I.value,"onUpdate:pageSize":e[5]||(e[5]=l=>I.value=l),total:J.value,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next"},null,8,["current-page","page-size","total"])]),t(de,{title:f.value==="add"?"新增账单":f.value==="edit"?"编辑账单":"账单详情",modelValue:g.value,"onUpdate:modelValue":e[14]||(e[14]=l=>g.value=l),width:"500px"},{footer:a(()=>[t(u,{onClick:e[13]||(e[13]=l=>g.value=!1)},{default:a(()=>e[26]||(e[26]=[c("取消")])),_:1}),f.value!=="view"?(x(),z(u,{key:0,type:"primary",onClick:te},{default:a(()=>e[27]||(e[27]=[c(" 确定 ")])),_:1})):j("",!0)]),default:a(()=>[t(se,{ref_key:"formRef",ref:S,model:o.value,rules:Q,"label-width":"100px",disabled:f.value==="view"},{default:a(()=>[t(V,{label:"姓名",prop:"name"},{default:a(()=>[t(m,{modelValue:o.value.name,"onUpdate:modelValue":e[6]||(e[6]=l=>o.value.name=l)},null,8,["modelValue"])]),_:1}),t(V,{label:"房间号",prop:"room"},{default:a(()=>[t(m,{modelValue:o.value.room,"onUpdate:modelValue":e[7]||(e[7]=l=>o.value.room=l)},null,8,["modelValue"])]),_:1}),t(V,{label:"账单类型",prop:"type"},{default:a(()=>[t(k,{modelValue:o.value.type,"onUpdate:modelValue":e[8]||(e[8]=l=>o.value.type=l),placeholder:"请选择账单类型"},{default:a(()=>[(x(),D(q,null,E(L,l=>t(v,{key:l,label:l,value:l},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"费用类别",prop:"category"},{default:a(()=>[t(k,{modelValue:o.value.category,"onUpdate:modelValue":e[9]||(e[9]=l=>o.value.category=l),placeholder:"请选择费用类别"},{default:a(()=>[(x(),D(q,null,E(G,l=>t(v,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"金额",prop:"amount"},{default:a(()=>[t(ue,{modelValue:o.value.amount,"onUpdate:modelValue":e[10]||(e[10]=l=>o.value.amount=l),min:0,precision:2,step:100,style:{width:"180px"}},null,8,["modelValue"])]),_:1}),t(V,{label:"支付方式",prop:"paymentMethod"},{default:a(()=>[t(k,{modelValue:o.value.paymentMethod,"onUpdate:modelValue":e[11]||(e[11]=l=>o.value.paymentMethod=l),placeholder:"请选择支付方式"},{default:a(()=>[t(v,{label:"现金",value:"现金"}),t(v,{label:"银行卡",value:"银行卡"}),t(v,{label:"微信",value:"微信"}),t(v,{label:"支付宝",value:"支付宝"})]),_:1},8,["modelValue"])]),_:1}),t(V,{label:"备注",prop:"description"},{default:a(()=>[t(m,{modelValue:o.value.description,"onUpdate:modelValue":e[12]||(e[12]=l=>o.value.description=l),type:"textarea",rows:2},null,8,["modelValue"])]),_:1})]),_:1},8,["model","disabled"])]),_:1},8,["title","modelValue"])])}}},Be=re(Te,[["__scopeId","data-v-681109cd"]]);export{Be as default};
